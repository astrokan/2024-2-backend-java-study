# 8주차 학습 내용

## 서비스 계층
- 어플리케이션의 비즈니스 로직이 담기는 계층

- 레포지토리 계층과 소통하며 엔티티, 또는 DTO로 소통한다.

- 어플리케이션의 비즈니스 로직을 수행한다.
  
<비즈니스 로직 예시>
- 할 일을 생성한다.
- 할 일은 인당 최대 10개까지 생성할 수 있다. (예시, 실제로 구현 x)
    1. 할 일을 생성하려는 유저를 조회한다.
    2. 해당 유저가 생성한 모든 할 일을 조회한다.
    3. 모든 할 일의 개수가 10개보다 적은 지 확인한다.
    4. 10개보다 적다면, 할 일을 생성한다.
- 할 일을 수정한다.
- 할 일은 그 일을 생성한 유저만 삭제할 수 있다.

비즈니스 로직 실행 도중 에러가 발생하거나,

서비스 정책에 맞지 않는 경우를 발견하는 경우

관련 로직은 전부 실행되지 않아야 한다.

즉, 해당 전체 로직은 더 이상 쪼갤 수 없는 원자성을 가진 로직이라고 할 수 있다.

(ex) '할 일은 인당 최대 10개까지 생성할 수 있다.'의 '1. ~ 4.'로직)

서비스 계층의 하나의 메서드에는 원자성을 갖는 로직을 기술하는데,

로직의 원자성을 보장하기 위해서 서비스 계층에 메서드 단위로 트랜잭션을 적용해준다.

## 서비스 객체 생성
-  객체를 중복해서 생성할 필요가 없기 때문에
  
  @Service 어노테이션을 이용하여 빈으로 등록해서 사용한다.
- 레포지토리 계층을 사용하는 서비스 로직은

  반드시 트랜잭션 안에서 동작하도록 작성한다.
- 메서드에 @Transactional 을 붙여준다.

## 서비스 테스트
- 서비스 테스트는 단위 테스트로 작성한다.
- 단위 테스트는 스프링 부트와 다른 클래스에 의존하지 않고,

  대상 자바 클래스 하나만 단독으로 테스트하는 것을 말한다.

### mock
- 서비스 클래스를 단독으로 테스트하기 위해,

  서비스가 의존하는 레포지토리는 가짜 객체를 사용한다.
- 이 가짜 객체를 가리켜 mock 이라고 한다.

### mocking
- 실제 객체를 흉내내는 mock을 만드는 행위를 mocking 이라고 한다.

- Mocking을 쉽게 도와주는 Mockito 라이브러리를 사용해 단위 테스트를 작성할 수 있다.


#### mocking 사용 방법
- @ExtendWith 어노테이션을 사용하여 테스트 클래스에 Mockito를 적용한다.
- @Mock을 사용하여 주입할 객체를 모킹한다.
- @InjectMocks를 사용하여, 서비스 객체를 생성할 때 모킹한 객체를 주입한다.
- given() 메서드로 mock 객체의 특정 메서드를 호출했을 때

  그 반환값을 임의로 지정할 수 있다.
- verify() 메서드로 mock 객체의 특정 메서드를 몇 번 호출했는지 검증할 수 있다.

  
  
